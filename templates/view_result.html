{% extends "base.html" %}

{% block title %}Exam Result{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h4 class="mb-0">Exam Result</h4>
    </div>
    <div class="card-body">
        <h5>{{ result.exam.title }}</h5>
        <p class="text-muted">Student: {{ result.student.full_name }} ({{ result.student.username }})</p>
        
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Total Marks</h6>
                        <h3>{{ result.total_marks }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Marks Obtained</h6>
                        <h3>{{ result.marks_obtained }}</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center">
                    <div class="card-body">
                        <h6>Percentage</h6>
                        <h3>{{ "%.2f"|format(result.percentage) }}%</h3>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card text-center text-white bg-{{ 'success' if result.status == 'pass' else 'danger' }}">
                    <div class="card-body">
                        <h6>Status</h6>
                        <h3>{{ result.status.upper() }}</h3>
                    </div>
                </div>
            </div>
        </div>
        
        <hr>
        
        <h5>Answer Details</h5>
        {% for answer in result.answers %}
        <div class="card mb-3">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-start mb-2">
                    <h6>Question {{ loop.index }}</h6>
                    <span class="badge bg-{{ 'success' if answer.is_correct else 'danger' }}">
                        {{ answer.marks_obtained }}/{{ answer.question.marks }} marks
                    </span>
                </div>
                <p><strong>{{ answer.question.question_text }}</strong></p>
                
                {% if answer.question.question_type == 'mcq' %}
                    {% set opts = answer.question.options|from_json %}
                    <p><strong>Your Answer:</strong> {{ opts[answer.answer_text|int] if answer.answer_text else 'Not answered' }}</p>
                    <p><strong>Correct Answer:</strong> {{ opts[answer.question.correct_answer|int] }}</p>
                
                {% elif answer.question.question_type == 'brief' %}
                    <p><strong>Your Answer:</strong> {{ answer.answer_text }}</p>
                    <p><strong>Model Answer:</strong> {{ answer.question.correct_answer }}</p>
                    <p class="text-muted small"><em>Note: Brief answers require manual evaluation by instructor.</em></p>
                
                {% else %}
                    <p><strong>Your Answer:</strong> {{ answer.answer_text or 'Not answered' }}</p>
                    <p><strong>Correct Answer:</strong> {{ answer.question.correct_answer }}</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}
        
        <div class="mt-4">
            {% if result.email_sent %}
                <div class="alert alert-info">
                    ✉️ Result has been sent to your email: {{ result.student.email }}
                </div>
            {% else %}
                <div class="alert alert-warning">
                    ⚠️ Email notification could not be sent (email service not configured)
                </div>
            {% endif %}
        </div>
        
        <div class="mt-3">
            <a href="{{ url_for('dashboard') }}" class="btn btn-primary">Back to Dashboard</a>
            <a href="{{ url_for('list_results') }}" class="btn btn-secondary">All Results</a>
        </div>
    </div>
</div>
{% endblock %}
